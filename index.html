<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Subnautica 3D Prototype</title>
  <style>
    body { margin:0; overflow:hidden; background: #003; }
    #hud {
      position:absolute; left:10px;top:10px; color:#fff;
      background:rgba(0,0,40,0.7); padding:10px; border-radius:8px; font-family:sans-serif; font-size:18px; z-index:10;
    }
    #craftPanel {
      position:absolute; right:12px; top:10px; color:#fff; background:rgba(0,30,60,0.7); padding:8px; border-radius:6px; font-family:sans-serif; font-size:16px; z-index:10;
    }
    button { font-size:16px; margin-top:6px; }
  </style>
</head>
<body>
  <div id="hud">
    <div id="info"></div>
    <div id="inventory"></div>
  </div>
  <div id="craftPanel">
    <b>Crafting</b><br>
    <button onclick="craftItem()">Construir Faca (2 Peixes, 3 Plantas)</button>
    <div id="craftMsg"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/controls/PointerLockControls.js"></script>
  <script>
    // --- Setup Three.js ---
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x003366, 8, 70);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 200);
    camera.position.set(0, 2, 0);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Iluminação subaquática
    scene.add(new THREE.AmbientLight(0x4488ff, 0.8));
    const sun = new THREE.DirectionalLight(0xcceeff, 2.5);
    sun.position.set(10,80,20);
    scene.add(sun);

    // HUD
    const infoDiv = document.getElementById('info');
    const invDiv = document.getElementById('inventory');
    const craftMsgDiv = document.getElementById('craftMsg');

    // --- Mundo Subaquático ---
    // Fundo do mar
    const seabed = new THREE.Mesh(
      new THREE.PlaneGeometry(100,100,32,32),
      new THREE.MeshPhongMaterial({color:0x224433, side:THREE.DoubleSide})
    );
    seabed.rotation.x = -Math.PI/2;
    seabed.position.y = -2;
    scene.add(seabed);

    // Rochas
    for(let i=0;i<20;i++){
      const rock = new THREE.Mesh(
        new THREE.DodecahedronGeometry(Math.random()+0.5),
        new THREE.MeshPhongMaterial({color:0x444455})
      );
      rock.position.set((Math.random()-0.5)*40,-1.8,(Math.random()-0.5)*40);
      scene.add(rock);
    }

    // Plantas
    let plants = [];
    for(let i=0;i<30;i++){
      const plant = new THREE.Mesh(
        new THREE.CylinderGeometry(0.14,0.2,2.2+Math.random()*1.5,6),
        new THREE.MeshPhongMaterial({color:0x13b86b})
      );
      plant.position.set((Math.random()-0.5)*48,-1.0,(Math.random()-0.5)*48);
      scene.add(plant);
      plants.push(plant);
    }

    // --- Criaturas ---
    let creatures = [];
    function spawnCreature(){
      let color = Math.random()<0.5 ? 0x00bbff : 0xffaa22;
      let geo = new THREE.SphereGeometry(0.6,14,14);
      let mat = new THREE.MeshPhongMaterial({color:color});
      let fish = new THREE.Mesh(geo, mat);

      fish.position.set((Math.random()-0.5)*40,Math.random()*5-1,(Math.random()-0.5)*40);
      fish.userData = {dir: Math.random()*Math.PI*2, alive:true};
      scene.add(fish);
      creatures.push(fish);
    }
    for(let i=0;i<16;i++) spawnCreature();

    // --- Recursos coletados ---
    let inventory = {peixe:0, planta:0, faca:0};

    // --- Controles FPS ---
    const controls = new THREE.PointerLockControls(camera, document.body);
    document.body.addEventListener('click', () => controls.lock());
    let vel = {f:0,b:0,l:0,r:0,up:0,down:0};
    window.addEventListener('keydown',e=>{
      switch(e.code){
        case 'KeyW': vel.f=1; break;
        case 'KeyS': vel.b=1; break;
        case 'KeyA': vel.l=1; break;
        case 'KeyD': vel.r=1; break;
        case 'Space': vel.up=1; break;
        case 'ShiftLeft': vel.down=1; break;
      }
    });
    window.addEventListener('keyup',e=>{
      switch(e.code){
        case 'KeyW': vel.f=0; break;
        case 'KeyS': vel.b=0; break;
        case 'KeyA': vel.l=0; break;
        case 'KeyD': vel.r=0; break;
        case 'Space': vel.up=0; break;
        case 'ShiftLeft': vel.down=0; break;
      }
    });

    // --- Interação: coletar criaturas/planta ---
    window.addEventListener('mousedown',()=>{
      // Raycast para interagir
      let ray = new THREE.Raycaster();
      let dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
      ray.set(camera.position, dir);
      // Checar criaturas
      let fishHits = ray.intersectObjects(creatures);
      for(let hit of fishHits){
        let fish = hit.object;
        if(fish.userData.alive && hit.distance<3){
          fish.userData.alive=false;
          fish.material.color.set(0x555555);
          inventory.peixe++;
          craftMsgDiv.textContent = "Você coletou um peixe!";
          updateHUD();
          break;
        }
      }
      // Checar plantas
      let plantHits = ray.intersectObjects(plants);
      for(let hit of plantHits){
        let plant = hit.object;
        if(hit.distance<3){
          scene.remove(plant);
          plants = plants.filter(p=>p!==plant);
          inventory.planta++;
          craftMsgDiv.textContent = "Você coletou uma planta!";
          updateHUD();
          break;
        }
      }
    });

    // --- Crafting ---
    function craftItem(){
      if(inventory.faca>0){
        craftMsgDiv.textContent = "Você já tem uma faca!";
        return;
      }
      if(inventory.peixe>=2 && inventory.planta>=3){
        inventory.peixe-=2;
        inventory.planta-=3;
        inventory.faca=1;
        craftMsgDiv.textContent = "Você construiu uma Faca!";
        updateHUD();
      }else{
        craftMsgDiv.textContent = "Faltam recursos!";
      }
    }
    window.craftItem = craftItem;

    // --- HUD ---
    function updateHUD(){
      invDiv.textContent = `Peixes: ${inventory.peixe} | Plantas: ${inventory.planta} | Faca: ${inventory.faca ? "Sim" : "Não"}`;
    }
    updateHUD();

    // --- Loop principal ---
    function animate(){
      requestAnimationFrame(animate);

      // Movimento FPS
      let speed = 0.14;
      let dir = new THREE.Vector3();
      if(vel.f) dir.z -= speed;
      if(vel.b) dir.z += speed;
      if(vel.l) dir.x -= speed;
      if(vel.r) dir.x += speed;
      controls.moveRight(dir.x);
      controls.moveForward(dir.z);
      if(vel.up) camera.position.y = Math.min(camera.position.y+speed,10);
      if(vel.down) camera.position.y = Math.max(camera.position.y-speed,-1.5);

      // Movimento criaturas
      for(let fish of creatures){
        if(fish.userData.alive){
          // Nada em direção aleatória, muda de vez em quando
          if(Math.random()<0.01) fish.userData.dir += (Math.random()-0.5)*0.8;
          fish.position.x += Math.cos(fish.userData.dir)*0.06;
          fish.position.z += Math.sin(fish.userData.dir)*0.06;
          fish.position.y += (Math.random()-0.5)*0.04;
          // Limite
          fish.position.x = Math.max(-49,Math.min(49,fish.position.x));
          fish.position.z = Math.max(-49,Math.min(49,fish.position.z));
          fish.position.y = Math.max(-1.2,Math.min(8,fish.position.y));
        }
      }

      // Informações
      infoDiv.textContent = `Profundidade: ${Math.max(0,Math.floor(2-camera.position.y))}m | Explore e colete recursos!`;

      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
