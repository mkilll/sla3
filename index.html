<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Jogo de Terror 2D</title>
  <style>
    body { margin: 0; background: #000; }
    canvas { display: block; margin: 0 auto; background: #111; }
    #hud {
      position: absolute; color: #fff; top:10px; left:10px; font-family:sans-serif; font-size:18px;
      z-index: 10; text-shadow: 2px 2px 4px #000;
    }
    #gameover {
      position: absolute; color: #f00; font-size:40px; font-weight:bold; top:40%; left:35%; z-index: 20;
      display: none; text-shadow: 3px 3px 8px #000;
    }
  </style>
</head>
<body>
  <div id="hud">Use WASD para mover. Fuja do monstro!</div>
  <div id="gameover">VOCÊ FOI PEGADO!</div>
  <canvas id="game" width="800" height="600"></canvas>
  <audio id="scream" src="https://cdn.pixabay.com/audio/2022/07/26/audio_12b6b0e4c8.mp3"></audio>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const gameoverDiv = document.getElementById("gameover");
    let width = canvas.width, height = canvas.height;

    // Jogador
    let player = { x: 100, y: 100, r: 18, speed: 3 };

    // Monstro
    let monster = { x: 600, y: 400, r: 25, speed: 2.0, active: true };

    // Obstáculos
    let walls = [
      {x:200,y:150,w:400,h:30},
      {x:100,y:400,w:600,h:35},
      {x:500,y:250,w:40,h:200},
      {x:300,y:100,w:35,h:150}
    ];

    // Controle
    let keys = {};
    window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    // Sons
    function scream() {
      document.getElementById("scream").play();
    }

    // Colisão (círculo-retângulo)
    function collideCircleRect(cx, cy, cr, rx, ry, rw, rh) {
      let closestX = Math.max(rx, Math.min(cx, rx + rw));
      let closestY = Math.max(ry, Math.min(cy, ry + rh));
      let dx = cx - closestX, dy = cy - closestY;
      return (dx * dx + dy * dy) < cr * cr;
    }

    // Movimento do jogador
    function movePlayer() {
      let nx = player.x, ny = player.y;
      if (keys['w']) ny -= player.speed;
      if (keys['s']) ny += player.speed;
      if (keys['a']) nx -= player.speed;
      if (keys['d']) nx += player.speed;

      // Checa paredes
      let canMove = true;
      for (let wall of walls) {
        if (collideCircleRect(nx, ny, player.r, wall.x, wall.y, wall.w, wall.h)) {
          canMove = false;
          break;
        }
      }
      if (canMove) {
        player.x = Math.max(player.r, Math.min(nx, width-player.r));
        player.y = Math.max(player.r, Math.min(ny, height-player.r));
      }
    }

    // Movimento do monstro
    function moveMonster() {
      if (!monster.active) return;
      let dx = player.x - monster.x;
      let dy = player.y - monster.y;
      let dist = Math.sqrt(dx*dx + dy*dy);

      // Persegue o jogador
      if (dist > 1) {
        let nx = monster.x + monster.speed * dx/dist;
        let ny = monster.y + monster.speed * dy/dist;
        // Checa paredes
        let canMove = true;
        for (let wall of walls) {
          if (collideCircleRect(nx, ny, monster.r, wall.x, wall.y, wall.w, wall.h)) {
            canMove = false;
            break;
          }
        }
        if (canMove) {
          monster.x = nx;
          monster.y = ny;
        }
      }
    }

    // Renderização
    function draw() {
      // Fundo
      ctx.fillStyle = "#111";
      ctx.fillRect(0,0,width,height);

      // Iluminação da lanterna (radial gradient)
      let grad = ctx.createRadialGradient(player.x, player.y, player.r, player.x, player.y, 180);
      grad.addColorStop(0, "rgba(255,255,200,0.9)");
      grad.addColorStop(0.3, "rgba(220,220,120,0.5)");
      grad.addColorStop(1, "rgba(0,0,0,0.98)");
      ctx.globalCompositeOperation = "source-over";
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,width,height);

      // Paredes
      ctx.globalCompositeOperation = "lighter";
      for (let wall of walls) {
        ctx.fillStyle = "#222";
        ctx.fillRect(wall.x, wall.y, wall.w, wall.h);
      }

      // Monstro
      if (monster.active) {
        ctx.save();
        ctx.shadowColor = "#f00"; ctx.shadowBlur = 20;
        ctx.beginPath();
        ctx.arc(monster.x, monster.y, monster.r, 0, 2*Math.PI);
        ctx.fillStyle = "#900";
        ctx.fill();
        ctx.restore();

        // Olhos
        ctx.beginPath();
        ctx.arc(monster.x-7, monster.y-6, 5, 0, 2*Math.PI);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.beginPath();
        ctx.arc(monster.x+7, monster.y-6, 5, 0, 2*Math.PI);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.beginPath();
        ctx.arc(monster.x-7, monster.y-6, 2, 0, 2*Math.PI);
        ctx.fillStyle = "#f00";
        ctx.fill();
        ctx.beginPath();
        ctx.arc(monster.x+7, monster.y-6, 2, 0, 2*Math.PI);
        ctx.fillStyle = "#f00";
        ctx.fill();
      }

      // Jogador
      ctx.save();
      ctx.shadowColor = "#fff"; ctx.shadowBlur = 10;
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.r, 0, 2*Math.PI);
      ctx.fillStyle = "#eee";
      ctx.fill();
      ctx.restore();
    }

    // Loop principal
    let gameOver = false;
    function loop() {
      if (!gameOver) {
        movePlayer();
        moveMonster();
        draw();

        // Checa derrota
        let dx = player.x - monster.x;
        let dy = player.y - monster.y;
        if (Math.sqrt(dx*dx + dy*dy) < player.r + monster.r) {
          gameOver = true;
          monster.active = false;
          gameoverDiv.style.display = "block";
          scream();
        }
        requestAnimationFrame(loop);
      }
    }
    loop();
  </script>
</body>
</html>
