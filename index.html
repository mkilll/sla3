<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Subnautica 2D Prototype</title>
  <style>
    body { margin:0; background: #003366;}
    canvas { display:block; margin:0 auto; background: #159aff;}
    #hud {
      position:absolute; left:10px;top:10px; color:#fff;
      background:rgba(0,0,40,0.7); padding:10px; border-radius:8px; font-family:sans-serif; font-size:18px; z-index:10;
      user-select:none;
    }
    #craftPanel {
      position:absolute; right:12px; top:10px; color:#fff; background:rgba(0,30,60,0.7); padding:8px; border-radius:6px; font-family:sans-serif; font-size:15px; z-index:10;
    }
    #craftMsg { margin-top:6px;}
    #buildMenu {
      display:none; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      background:rgba(0,30,60,0.92); color:#fff; padding:24px 40px; border-radius:16px; font-size:18px; z-index:100;
      box-shadow:0 0 32px #000a;
      min-width:320px;
    }
    #buildMenu button {
      display:block; width:100%; margin:8px 0; padding:12px; font-size:18px; border-radius:8px; border:none; background:#159; color:#fff; cursor:pointer;
      transition: background 0.2s;
    }
    #buildMenu button:hover { background:#37f; }
  </style>
</head>
<body>
  <div id="hud">
    <div id="info"></div>
    <div id="inventory"></div>
  </div>
  <div id="craftPanel">
    <b>Crafting</b><br>
    <button onclick="craftItem()">Construir Faca (2 Peixes, 3 Plantas)</button>
    <div id="craftMsg"></div>
  </div>
  <div id="buildMenu">
    <h2>Menu de Construção</h2>
    <button onclick="build('base')">Construir Base Subaquática (8 Peixes, 4 Plantas)</button>
    <button onclick="build('veiculo')">Construir Veículo (12 Peixes, 10 Plantas)</button>
    <button onclick="closeBuildMenu()">Fechar [TAB]</button>
    <div id="buildMsg" style="margin-top:10px;"></div>
  </div>
  <canvas id="game" width="1000" height="600"></canvas>
  <script>
    // --- VARIÁVEIS ---
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let width = canvas.width, height = canvas.height;

    // Player submarino
    let player = {
      x: width/2, y: height/2,
      vx:0, vy:0,
      w:48, h:24,
      dir:0,
      speed:2.5,
      color:"#ffe02b"
    };

    // Recursos
    let inventory = {peixe:0, planta:0, faca:0, base:0, veiculo:0};

    // HUD
    const infoDiv = document.getElementById('info');
    const invDiv = document.getElementById('inventory');
    function updateHUD() {
      invDiv.textContent = `Peixes: ${inventory.peixe} | Plantas: ${inventory.planta} | Faca: ${inventory.faca ? "Sim" : "Não"} | Bases: ${inventory.base} | Veículos: ${inventory.veiculo}`;
    }
    updateHUD();

    // --- OBJETOS DO MUNDO ---
    // Plantas
    let plants = [];
    for(let i=0;i<22;i++){
      plants.push({
        x:Math.random()*width,
        y:height-60+Math.random()*40,
        w:12, h:36,
        color:"#13b86b"
      });
    }
    // Peixes amigáveis
    let fishes = [];
    for(let i=0;i<14;i++){
      fishes.push({
        x:Math.random()*width,
        y:Math.random()*(height-120)+60,
        w:26, h:12,
        dir:Math.random()<0.5?1:-1,
        color: Math.random()<0.5?"#1befff":"#ffa922",
        t:Math.random()*100
      });
    }
    // Criaturas hostis
    let hostiles = [];
    for(let i=0;i<7;i++){
      hostiles.push({
        x:Math.random()*width,
        y:Math.random()*(height-120)+60,
        w:38, h:18,
        dir:Math.random()<0.5?1:-1,
        color:"#ff2244",
        t:Math.random()*100
      });
    }
    // Bases e veículos
    let bases = [];
    let vehicles = [];

    // --- MOVIMENTO ---
    let keys = {};
    window.addEventListener('keydown',e=>{
      keys[e.key.toLowerCase()] = true;
      if(e.code==="Tab") { e.preventDefault(); toggleBuildMenu(); }
    });
    window.addEventListener('keyup',e=>{
      keys[e.key.toLowerCase()] = false;
    });

    // --- INTERAÇÃO: COLETAR ---
    canvas.addEventListener('mousedown',e=>{
      let mx = e.offsetX, my = e.offsetY;
      // Peixes
      for(let fish of fishes){
        if(Math.abs(mx-fish.x)<fish.w && Math.abs(my-fish.y)<fish.h){
          inventory.peixe++;
          craftMsgDiv.textContent = "Você coletou um peixe!";
          fish.x = Math.random()*width;
          fish.y = Math.random()*(height-120)+60;
          updateHUD();
          return;
        }
      }
      // Plantas
      for(let plant of plants){
        if(Math.abs(mx-plant.x)<plant.w && Math.abs(my-plant.y)<plant.h){
          inventory.planta++;
          craftMsgDiv.textContent = "Você coletou uma planta!";
          plant.x = Math.random()*width;
          plant.y = height-60+Math.random()*40;
          updateHUD();
          return;
        }
      }
    });

    // --- CRAFTING ---
    const craftMsgDiv = document.getElementById('craftMsg');
    function craftItem(){
      if(inventory.faca>0){
        craftMsgDiv.textContent = "Você já tem uma faca!";
        return;
      }
      if(inventory.peixe>=2 && inventory.planta>=3){
        inventory.peixe-=2;
        inventory.planta-=3;
        inventory.faca=1;
        craftMsgDiv.textContent = "Você construiu uma Faca!";
        updateHUD();
      }else{
        craftMsgDiv.textContent = "Faltam recursos!";
      }
    }
    window.craftItem = craftItem;

    // --- MENU DE CONSTRUÇÃO ---
    let buildMenuOpen = false;
    function toggleBuildMenu() {
      buildMenuOpen = !buildMenuOpen;
      document.getElementById("buildMenu").style.display = buildMenuOpen ? "block" : "none";
    }
    function closeBuildMenu() {
      buildMenuOpen = false;
      document.getElementById("buildMenu").style.display = "none";
    }
    window.closeBuildMenu = closeBuildMenu;

    function build(tipo) {
      let msg = '';
      if(tipo==='base') {
        if(inventory.peixe>=8 && inventory.planta>=4){
          inventory.peixe -= 8;
          inventory.planta -= 4;
          // Adiciona base na posição do player
          bases.push({x:player.x, y:player.y+40, w:76, h:32, color:"#9cf"});
          inventory.base++;
          msg = "Base construída!";
        } else msg = "Faltam recursos!";
      }
      if(tipo==='veiculo') {
        if(inventory.peixe>=12 && inventory.planta>=10){
          inventory.peixe -= 12;
          inventory.planta -= 10;
          vehicles.push({x:player.x+60, y:player.y, w:68, h:28, color:"#f5e099"});
          inventory.veiculo++;
          msg = "Veículo construído!";
        } else msg = "Faltam recursos!";
      }
      document.getElementById("buildMsg").textContent = msg;
      updateHUD();
    }
    window.build = build;

    // --- LOOP PRINCIPAL ---
    function drawFish(fish){
      ctx.save();
      ctx.translate(fish.x, fish.y);
      ctx.scale(fish.dir,1);
      // Corpo oval
      ctx.beginPath();
      ctx.ellipse(0,0,fish.w,fish.h,0,0,2*Math.PI);
      ctx.fillStyle=fish.color; ctx.fill();
      // Cauda
      ctx.beginPath();
      ctx.moveTo(-fish.w,0);
      ctx.lineTo(-fish.w-12,6);
      ctx.lineTo(-fish.w-12,-6);
      ctx.closePath();
      ctx.fillStyle=fish.color; ctx.globalAlpha=0.8; ctx.fill(); ctx.globalAlpha=1;
      // Olho
      ctx.beginPath();
      ctx.arc(fish.w-8,-3,3.6,0,2*Math.PI);
      ctx.fillStyle="#fff"; ctx.fill();
      ctx.beginPath();
      ctx.arc(fish.w-7,-3,1.5,0,2*Math.PI);
      ctx.fillStyle="#04c"; ctx.fill();
      ctx.restore();
    }
    function drawHostile(h){
      ctx.save();
      ctx.translate(h.x, h.y);
      ctx.scale(h.dir,1);
      // Corpo oval
      ctx.beginPath();
      ctx.ellipse(0,0,h.w,h.h,0,0,2*Math.PI);
      ctx.fillStyle=h.color; ctx.fill();
      // Cauda triangular
      ctx.beginPath();
      ctx.moveTo(-h.w,0);
      ctx.lineTo(-h.w-16,12);
      ctx.lineTo(-h.w-16,-12);
      ctx.closePath();
      ctx.fillStyle="#b00"; ctx.globalAlpha=0.85; ctx.fill(); ctx.globalAlpha=1;
      // Dentes hostis
      ctx.beginPath();
      ctx.moveTo(h.w-6,3);
      ctx.lineTo(h.w,6);
      ctx.lineTo(h.w-2,0);
      ctx.lineTo(h.w, -6);
      ctx.lineTo(h.w-6, -3);
      ctx.closePath();
      ctx.fillStyle="#fff"; ctx.fill();
      // Olho
      ctx.beginPath();
      ctx.arc(h.w-8,-3,3.8,0,2*Math.PI);
      ctx.fillStyle="#fff"; ctx.fill();
      ctx.beginPath();
      ctx.arc(h.w-7,-3,1.9,0,2*Math.PI);
      ctx.fillStyle="#900"; ctx.fill();
      ctx.restore();
    }
    function drawPlant(plant){
      ctx.save();
      ctx.translate(plant.x, plant.y);
      ctx.beginPath();
      ctx.moveTo(0,plant.h/2);
      ctx.bezierCurveTo(-6,-plant.h/3,6,-plant.h/2,0,-plant.h/2);
      ctx.lineWidth = 7;
      ctx.strokeStyle = plant.color;
      ctx.stroke();
      ctx.restore();
    }
    function drawBase(b){
      ctx.save();
      ctx.translate(b.x,b.y);
      ctx.beginPath();
      ctx.ellipse(0,0,b.w,b.h,0,0,2*Math.PI);
      ctx.fillStyle=b.color; ctx.globalAlpha=0.93; ctx.fill(); ctx.globalAlpha=1;
      ctx.beginPath();
      ctx.arc(0,-b.h/2,16,0,Math.PI,true);
      ctx.strokeStyle="#fff"; ctx.lineWidth=3; ctx.stroke();
      ctx.restore();
    }
    function drawVehicle(v){
      ctx.save();
      ctx.translate(v.x,v.y);
      // Corpo
      ctx.beginPath();
      ctx.rect(-v.w/2,-v.h/2,v.w,v.h);
      ctx.fillStyle=v.color; ctx.globalAlpha=0.93; ctx.fill(); ctx.globalAlpha=1;
      // Dome
      ctx.beginPath();
      ctx.arc(v.w/4,-v.h/4,12,Math.PI,2*Math.PI,false);
      ctx.fillStyle="#7ef"; ctx.globalAlpha=0.7; ctx.fill(); ctx.globalAlpha=1;
      ctx.restore();
    }
    function drawPlayer(){
      ctx.save();
      ctx.translate(player.x, player.y);
      // Submarino corpo oval
      ctx.rotate(player.dir);
      ctx.beginPath();
      ctx.ellipse(0,0,player.w,player.h,0,0,2*Math.PI);
      ctx.fillStyle=player.color; ctx.fill();
      // Janelinha
      ctx.beginPath();
      ctx.arc(player.w/3,0,9,0,2*Math.PI);
      ctx.fillStyle="#7ef"; ctx.globalAlpha=0.6; ctx.fill(); ctx.globalAlpha=1;
      // Hélice animada
      ctx.save();
      ctx.translate(-player.w,0);
      ctx.rotate(Math.sin(Date.now()/120)*0.3);
      ctx.beginPath();
      ctx.rect(-8,-4,16,8);
      ctx.fillStyle="#fff"; ctx.globalAlpha=0.4; ctx.fill(); ctx.globalAlpha=1;
      ctx.restore();
      ctx.restore();
    }

    function drawBackground(){
      // Mar azul gradiente
      let grad = ctx.createLinearGradient(0,0,0,height);
      grad.addColorStop(0, "#7ed6ff");
      grad.addColorStop(0.5, "#159aff");
      grad.addColorStop(1, "#208672");
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,width,height);
      // Solo modelado
      ctx.save();
      ctx.beginPath();
      for(let x=0;x<=width;x+=12){
        let y = height-30 + Math.sin(x/70)*14 + Math.cos(x/32)*8;
        if(x===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      }
      ctx.lineTo(width,height);
      ctx.lineTo(0,height);
      ctx.closePath();
      ctx.fillStyle="#208672"; ctx.fill();
      ctx.restore();
    }

    function gameLoop(){
      // Movimento player
      if(keys['w']) { player.vy -= player.speed*0.15; }
      if(keys['s']) { player.vy += player.speed*0.15; }
      if(keys['a']) { player.vx -= player.speed*0.15; }
      if(keys['d']) { player.vx += player.speed*0.15; }
      player.vx *= 0.84;
      player.vy *= 0.84;
      player.x += player.vx;
      player.y += player.vy;
      // Limites
      player.x = Math.max(player.w/2, Math.min(width-player.w/2, player.x));
      player.y = Math.max(player.h/2, Math.min(height-player.h/2, player.y));
      player.dir = Math.atan2(player.vy,player.vx);

      // Movimento peixes
      for(let fish of fishes){
        fish.t += Math.random()*0.3;
        fish.x += fish.dir*1.3 + Math.sin(fish.t/18)*0.7;
        fish.y += Math.sin(fish.t/12)*0.6;
        if(fish.x<-20||fish.x>width+20){ fish.dir*=-1; }
        fish.y = Math.max(40, Math.min(height-80, fish.y));
      }
      // Movimento hostis
      for(let h of hostiles){
        h.t += Math.random()*0.3;
        h.x += h.dir*2.1 + Math.sin(h.t/11)*0.7;
        h.y += Math.sin(h.t/8)*0.7;
        if(h.x<-30||h.x>width+30){ h.dir*=-1; }
        h.y = Math.max(50, Math.min(height-40, h.y));
        // Hostil ataca player
        if(Math.abs(h.x-player.x)<h.w && Math.abs(h.y-player.y)<h.h){
          ctx.save();
          ctx.font = "bold 38px sans-serif";
          ctx.fillStyle = "#ff2244";
          ctx.fillText("Você foi atacado!", width/2-120, 70);
          ctx.restore();
        }
      }

      // --- DRAW ---
      drawBackground();

      for(let plant of plants) drawPlant(plant);
      for(let base of bases) drawBase(base);
      for(let v of vehicles) drawVehicle(v);
      for(let fish of fishes) drawFish(fish);
      for(let h of hostiles) drawHostile(h);
      drawPlayer();

      // HUD Info
      infoDiv.textContent = `Explore, colete recursos e construa! (WASD para mover, clique para coletar, TAB para construir)`;

      requestAnimationFrame(gameLoop);
    }
    gameLoop();
  </script>
</body>
</html>
